<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consulta por Excel – Resultados ICFES Saber 11</title>

    <!-- Bootstrap 5 -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >

    <style>
        body {
            background: #f5f7fa;
            padding-bottom: 40px;
        }
        .card-custom {
            max-width: 650px;
            margin: 60px auto;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0.1);
        }
        .btn-custom {
            background-color: #0054a6;
            color: white;
        }
        .btn-custom:hover {
            background-color: #003f7a;
            color: white;
        }
        code {
            background: #eef1f5;
            padding: 2px 4px;
            border-radius: 4px;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="card card-custom p-4">

        <h3 class="text-center mb-3">Consulta Masiva por Excel</h3>
        <p class="text-center text-muted mb-4">
            Sube un archivo Excel con los datos de los estudiantes para consultar
            sus resultados automáticamente.
        </p>

        <!-- Mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-3">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="mb-3">
            <h6>Formato esperado del archivo Excel</h6>
            <p class="mb-1">El archivo debe tener, como mínimo, las siguientes columnas:</p>
            <ul>
                <li><code>tipo_documento</code></li>
                <li><code>numero_documento</code></li>
                <li><code>fecha_nacimiento</code></li>
            </ul>
            <p class="text-muted mb-0">
                La fecha puede venir en formato <code>YYYY-MM-DD</code> o <code>DD/MM/YYYY</code>.
            </p>
        </div>

        <form
            action="{{ url_for('consulta_excel_procesar') }}"
            method="POST"
            enctype="multipart/form-data"
        >

            <!-- Archivo Excel -->
            <div class="mb-3">
                <label class="form-label">Archivo Excel</label>
                <input
                    type="file"
                    name="archivo"
                    class="form-control"
                    accept=".xls,.xlsx"
                    required
                >
                <div class="form-text">
                    Tamaño máximo sugerido: 16 MB. Extensiones permitidas: <code>.xls</code>, <code>.xlsx</code>.
                </div>
            </div>

            <!-- Tomar screenshot -->
            <div class="form-check mb-3">
                <input
                    class="form-check-input"
                    type="checkbox"
                    name="take_screenshot"
                    id="checkScreenshotExcel"
                >
                <label class="form-check-label" for="checkScreenshotExcel">
                    Tomar screenshot de la página de resultados por cada estudiante
                    <span class="text-muted d-block" style="font-size: 0.85rem;">
                        (esto puede hacer que el proceso tarde más tiempo).
                    </span>
                </label>
            </div>

            <!-- Botón -->
            <button type="submit" class="btn btn-custom w-100">
                Procesar Archivo
            </button>

        </form>

        <div class="text-center mt-4">
            <a href="{{ url_for('index') }}">← Volver a consulta manual</a>
        </div>

    </div>
</div>

</body>
</html>